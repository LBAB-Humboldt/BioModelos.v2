$(document).ready(function(){
	console.log("send");
	validate.validators.presence.message = "no puede estar vacío";

	// Validación de los campos editables de un registro.
	var latRecordEdition = $("#txtLatEdit").val(),
		lonRecordEdition = $("#txtLonEdit").val(),
		speRecordEdition = $("#txtSpeciesEdit").val(),
		locRecordEdition = $("#txtLocEdit").val();

	var varsToValidate = {},
	constraints = {},
	data = {userId_bm: <%= current_user.id %>};

	if (latRecordEdition != $("#oldLatEdit").val()){
		varsToValidate.lat = latRecordEdition;
		constraints.lat = {};
		constraints.lat.numericality = {};
		constraints.lat.presence = true;
		constraints.lat.numericality.greaterThanOrEqualTo = -90;
		constraints.lat.numericality.lessThanOrEqualTo = 90;
		data.lat = latRecordEdition;
	}
	if (lonRecordEdition != $("#oldLonEdit").val()){
		varsToValidate.lon = lonRecordEdition;
		constraints.lon = {};
		constraints.lon.numericality = {};
		constraints.lon.presence = true;
		constraints.lon.numericality.greaterThanOrEqualTo = -180;
		constraints.lon.numericality.lessThanOrEqualTo = 180;
		data.lon = lonRecordEdition;
	}
	if(speRecordEdition != $("#oldSpeciesEdit").val()){
		varsToValidate.speciesOriginal = speRecordEdition; 
		data.speciesOriginal = speRecordEdition;
	}
	if (locRecordEdition != $("#oldLocEdit").val()){
		varsToValidate.localidad = locRecordEdition;
		constraints.localidad = {};
		constraints.localidad.presence = true;
		data.locality = locRecordEdition;
	}
	var valResponse = validate(varsToValidate, constraints, {format: "flat"});
	console.log(valResponse);
	if(valResponse){
		var response = "";
		for(var i=0; i<valResponse.length; i++){
			response += valResponse[i] + "\n";
		}
		console.log(response);
		alertify.alert(response);
	}
	else{
		console.log("Sin respuesta");
		console.log(data);
		$.ajax({
		    type: 'PUT',
		    dataType: 'json',
		    url: "http://192.168.11.81:3000/BioModelos/records/" + $("#bm_db_id").val(),
		    data: data,
		    success: function(){
				_BioModelosVisorModule.getSpeciesRecords($("#species_id_field").val());
				alertify.alert("Su edición se ha realizado con éxito");
			},
			error: function(jqXHR, textStatus, errorThrown){
				alertify.alert("Ha ocurrido un error al editar el registro: " + textStatus);
			}
		});
	}
});